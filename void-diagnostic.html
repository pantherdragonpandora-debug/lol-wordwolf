<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ´ã‚©ã‚¤ãƒ‰ã‚²ãƒ¼ãƒ è¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0a0e27;
            color: #e0e0e0;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 5px solid;
        }
        .success {
            background: rgba(0, 255, 0, 0.1);
            border-color: #00ff00;
        }
        .error {
            background: rgba(255, 0, 0, 0.1);
            border-color: #ff0000;
        }
        .info {
            background: rgba(0, 150, 255, 0.1);
            border-color: #0096ff;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        #console-output {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
        }
        .log-success { color: #00ff00; }
        .log-error { color: #ff0000; }
        .log-info { color: #0096ff; }
        .log-warn { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ãƒ´ã‚©ã‚¤ãƒ‰ã‚²ãƒ¼ãƒ è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
    
    <div id="results"></div>
    
    <h2>ğŸ“‹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</h2>
    <div id="console-output"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="runTests()">ğŸ” è¨ºæ–­ã‚’å†å®Ÿè¡Œ</button>
        <button onclick="testCreateRoom()">ğŸ® ãƒ«ãƒ¼ãƒ ä½œæˆãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearConsole()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Firebaseè¨­å®š -->
    <script src="js/firebase-config.js"></script>
    
    <!-- ãƒ´ã‚©ã‚¤ãƒ‰ã‚²ãƒ¼ãƒ é–¢é€£ -->
    <script src="js/void-data.js?v=26&t=20260217"></script>
    <script src="js/void-game.js?v=26&t=20260217"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');
        const consoleOutput = document.getElementById('console-output');
        
        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsole(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR: ' + args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('WARN: ' + args.join(' '), 'warn');
        };
        
        function clearConsole() {
            consoleOutput.innerHTML = '';
        }
        
        function addResult(title, status, message) {
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            resultsDiv.appendChild(div);
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        function runTests() {
            clearResults();
            console.log('=== è¨ºæ–­é–‹å§‹ ===');
            
            // ãƒ†ã‚¹ãƒˆ1: Firebaseæ¥ç¶š
            if (typeof firebase !== 'undefined') {
                addResult('âœ… Firebase SDK', 'success', 'Firebase SDKãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
                console.log('âœ… Firebase SDK: OK');
            } else {
                addResult('âŒ Firebase SDK', 'error', 'Firebase SDKãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                console.error('âŒ Firebase SDK: æœªèª­ã¿è¾¼ã¿');
            }
            
            // ãƒ†ã‚¹ãƒˆ2: void-data.js
            if (typeof getRandomVoidTheme !== 'undefined') {
                addResult('âœ… void-data.js', 'success', 'ãƒ´ã‚©ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
                console.log('âœ… void-data.js: OK');
            } else {
                addResult('âŒ void-data.js', 'error', 'void-data.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                console.error('âŒ void-data.js: æœªèª­ã¿è¾¼ã¿');
            }
            
            // ãƒ†ã‚¹ãƒˆ3: void-game.js (VoidGameã‚¯ãƒ©ã‚¹)
            if (typeof VoidGame !== 'undefined') {
                addResult('âœ… VoidGame (ã‚°ãƒ­ãƒ¼ãƒãƒ«)', 'success', 'VoidGameãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                console.log('âœ… VoidGame (ã‚°ãƒ­ãƒ¼ãƒãƒ«): OK');
            } else {
                addResult('âš ï¸ VoidGame (ã‚°ãƒ­ãƒ¼ãƒãƒ«)', 'info', 'VoidGameãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã«æœªå®šç¾©ï¼ˆwindow.VoidGameã‚’ç¢ºèªã—ã¾ã™ï¼‰');
                console.warn('âš ï¸ VoidGame (ã‚°ãƒ­ãƒ¼ãƒãƒ«): æœªå®šç¾©');
            }
            
            // ãƒ†ã‚¹ãƒˆ4: window.VoidGame
            if (typeof window.VoidGame !== 'undefined') {
                addResult('âœ… window.VoidGame', 'success', 'window.VoidGameãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                console.log('âœ… window.VoidGame: OK');
                console.log('   Type:', typeof window.VoidGame);
                console.log('   Name:', window.VoidGame.name);
            } else {
                addResult('âŒ window.VoidGame', 'error', 'window.VoidGameãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                console.error('âŒ window.VoidGame: æœªå®šç¾©');
            }
            
            // ãƒ†ã‚¹ãƒˆ5: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆãƒ†ã‚¹ãƒˆ
            try {
                const VoidGameClass = window.VoidGame || VoidGame;
                const testInstance = new VoidGameClass('test123', 'lol');
                addResult('âœ… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ', 'success', 'VoidGameã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã§ãã¾ã—ãŸ');
                console.log('âœ… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ: æˆåŠŸ');
                console.log('   roomId:', testInstance.roomId);
                console.log('   gameType:', testInstance.gameType);
            } catch (error) {
                addResult('âŒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ', 'error', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('âŒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆå¤±æ•—:', error);
            }
            
            console.log('=== è¨ºæ–­å®Œäº† ===');
        }
        
        async function testCreateRoom() {
            console.log('=== ãƒ«ãƒ¼ãƒ ä½œæˆãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            try {
                const VoidGameClass = window.VoidGame || VoidGame;
                if (!VoidGameClass) {
                    throw new Error('VoidGameã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ«ãƒ¼ãƒ IDã‚’ç”Ÿæˆ
                const testRoomId = String(Math.floor(Math.random() * 900000) + 100000);
                console.log('ãƒ†ã‚¹ãƒˆãƒ«ãƒ¼ãƒ ID:', testRoomId);
                
                // ãƒ†ãƒ¼ãƒã‚’å–å¾—
                const theme = getRandomVoidTheme('lol');
                console.log('ãƒ†ãƒ¼ãƒ:', theme);
                
                // ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                const game = new VoidGameClass(testRoomId, 'lol');
                console.log('VoidGameã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ: OK');
                
                // ãƒ«ãƒ¼ãƒ ä½œæˆã‚’è©¦è¡Œ
                await game.createRoom('ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼', 4, theme);
                console.log('âœ… ãƒ«ãƒ¼ãƒ ä½œæˆæˆåŠŸï¼');
                addResult('âœ… ãƒ«ãƒ¼ãƒ ä½œæˆ', 'success', `ãƒ«ãƒ¼ãƒ ID ${testRoomId} ã®ä½œæˆã«æˆåŠŸã—ã¾ã—ãŸ`);
                
            } catch (error) {
                console.error('âŒ ãƒ«ãƒ¼ãƒ ä½œæˆå¤±æ•—:', error);
                addResult('âŒ ãƒ«ãƒ¼ãƒ ä½œæˆ', 'error', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                
                // Firebaseæ¨©é™ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
                if (error.message.includes('permission') || error.message.includes('PERMISSION_DENIED')) {
                    addResult('ğŸ’¡ è§£æ±ºæ–¹æ³•', 'info', 
                        'Firebaseã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã« void_rooms ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>' +
                        'FIREBASE_PERMISSION_FIX.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚');
                }
            }
            
            console.log('=== ãƒ«ãƒ¼ãƒ ä½œæˆãƒ†ã‚¹ãƒˆå®Œäº† ===');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', function() {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>
