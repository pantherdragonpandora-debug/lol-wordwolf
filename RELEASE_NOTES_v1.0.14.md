# 🎉 リリースノート v1.0.14

## 📅 リリース情報
- **バージョン:** v1.0.14
- **リリース日:** 2026-02-14
- **種別:** バグ修正 + 機能改善

## 🎯 主な変更内容

### 🐛 バグ修正

#### ワードウルフの投票システム修正
**問題:** 誰か一人が投票した瞬間に結果が表示され、他のプレイヤーが投票できない

**修正内容:**
- ✅ 全員の投票完了を待ってから結果を表示するように変更
- ✅ Firebaseリアルタイム監視により自動的に投票完了を検知
- ✅ デマーシアモードと同じ投票システムを採用

**影響範囲:** ワードウルフ（LOL、VALORANT、TFT）すべてのモード

---

## 🆕 新機能

### 1. 投票状況のリアルタイム表示

投票画面に投票状況が表示されるようになりました：

```
2 / 5 人が投票完了
```

**機能詳細:**
- 何人が投票完了したかリアルタイムで表示
- 全員投票完了時に自動で結果画面へ遷移
- 視覚的なフィードバックで待機時間のストレス軽減

### 2. 投票後のUI制御

投票完了後の動作改善：

**変更前:**
- 投票後もボタンが有効
- 再投票が可能（バグの原因）

**変更後:**
- ✅ 投票ボタンが「投票完了」に変化
- ✅ ボタンが無効化され、再投票不可
- ✅ ラジオボタンも無効化
- ✅ 「他のプレイヤーの投票を待っています...」アラート表示

### 3. 詳細な投票結果の表示

結果画面の表示が強化されました：

**追加された情報:**
- 各プレイヤーが誰に投票したか
- ウルフは赤色、市民は青色で色分け表示
- 投票数の集計結果

**表示例:**
```
各プレイヤーの投票:
  Player1 → Player3  (青色: 市民)
  Player2 → Player3  (青色: 市民)
  Player3 → Player1  (赤色: ウルフ)
  Player4 → Player3  (青色: 市民)

投票数:
  Player3: 3 票
  Player1: 1 票
```

---

## 🔧 技術的改善

### 投票完了検知システム

```javascript
async function checkWordWolfVotingComplete(roomData) {
  const players = Object.values(roomData.players);
  const totalPlayers = players.length;
  const votedPlayers = players.filter(p => p.vote !== null).length;
  
  // 全員が投票完了したら結果集計
  if (votedPlayers === totalPlayers && totalPlayers > 0) {
    await currentGame.endVoting();
  }
}
```

**特徴:**
- Firebaseリアルタイム監視による自動検知
- 全員完了時のみ`endVoting()`を実行
- デマーシアモードと統一された実装

### ルームデータ監視の強化

```javascript
// ワードウルフの投票画面
if (roomData.gameState === 'voting') {
  showVotingScreen(roomData);
  checkWordWolfVotingComplete(roomData);  // 追加
}

// デマーシアの投票画面
else if (roomData.gameState === 'voting') {
  showDemaciaVotingScreen();
  checkDemaciaVotingComplete();  // 追加
}
```

---

## 📊 変更統計

### ファイル変更
| ファイル | 追加 | 削除 | 変更内容 |
|---------|-----|-----|---------|
| `js/main.js` | +75 | -20 | 投票システム全面改修 |
| `index.html` | +5 | 0 | 投票状況UI追加 |
| `js/version.js` | +1 | -1 | バージョン更新 |
| **合計** | **+81** | **-21** | **3ファイル** |

### コード品質
- ✅ 投票ロジックの一貫性向上
- ✅ リアルタイム同期の信頼性向上
- ✅ ユーザーフィードバックの改善
- ✅ デバッグ用ログの追加

---

## 🧪 テスト項目

### 必須テスト（3人以上推奨）

#### ワードウルフ投票フロー
- [ ] 投票画面に投票状況が表示される
- [ ] 各プレイヤーが投票できる
- [ ] 投票後にボタンが無効化される
- [ ] 投票状況がリアルタイム更新される
- [ ] 全員投票完了時に自動で結果画面へ遷移
- [ ] 結果画面に各プレイヤーの投票先が表示される
- [ ] 投票数の集計が正しい

#### デマーシア投票フロー（既存機能の確認）
- [ ] 演技者以外が投票できる
- [ ] 全員投票完了時に結果画面へ遷移
- [ ] 結果画面に投票者結果が表示される

---

## 🔍 互換性

### ブラウザ対応
- ✅ Chrome / Edge (最新版)
- ✅ Firefox (最新版)
- ✅ Safari (最新版)
- ✅ モバイルブラウザ (iOS Safari, Chrome Mobile)

### 既存データへの影響
- ✅ 既存のルームデータと互換性あり
- ✅ マイグレーション不要
- ✅ 進行中のゲームには影響なし（新規ゲームから適用）

### Firebase構造
- ✅ データベース構造の変更なし
- ✅ 既存のセキュリティルールで動作
- ✅ 追加のセットアップ不要

---

## 📝 アップグレード手順

### 1. ブラウザキャッシュのクリア

**自動クリア:**
- ページアクセス時に自動的にキャッシュクリア
- 通知表示: `🎉 アップデート完了！ v1.0.14`

**手動クリア:**
```
Windows: Ctrl + Shift + R
Mac: Cmd + Shift + R
```

### 2. 動作確認

**確認方法:**
1. ブラウザのコンソールを開く（F12）
2. 以下のコマンドを実行:
   ```javascript
   getAppVersion()
   ```
3. 結果が `"1.0.14"` と表示されればOK

### 3. テストプレイ

**推奨テスト:**
1. ワードウルフで3人以上のゲームを作成
2. 全員で投票を実行
3. 投票状況が正しく表示されるか確認
4. 結果画面で投票結果が表示されるか確認

---

## 🐛 既知の問題

現時点で既知の問題はありません。

---

## 🔜 次回アップデート予定

### v1.1.0（予定）
- 🎨 UI/UXの全面改善
- 📊 統計機能の追加（勝率、プレイ回数など）
- 🎮 カスタムゲームモード
- 🌐 より多くの言語サポート

### v1.2.0（予定）
- 👥 フレンドシステム
- 🏆 ランキング機能
- 🎁 アチーブメントシステム

---

## 💡 フィードバック

バグ報告や機能要望は以下の方法でお知らせください：
- GitHub Issues
- プロジェクトのREADME記載の連絡先

---

## 🙏 謝辞

このバージョンは、ユーザーの皆様からのフィードバックを基に改善を行いました。
特に「投票システムの不具合」を報告いただいた方々に感謝いたします。

---

## 📚 ドキュメント

### 新規ドキュメント
- `WORDWOLF_VOTING_FIX_v1.0.14.md` - 今回の修正の詳細解説

### 更新ドキュメント
- `README.md` - バージョン情報の更新

### 既存ドキュメント
- `DEMACIA_VOTING_SYSTEM.md` - デマーシア投票システム
- `QUICK_API_KEY_FIX.md` - Firebase APIキー管理

---

## 📞 サポート

問題が発生した場合：
1. `WORDWOLF_VOTING_FIX_v1.0.14.md` のトラブルシューティングを確認
2. ブラウザのコンソールでエラーログを確認
3. 上記で解決しない場合はフィードバックをお送りください

---

**Happy Gaming! 🎮**

---

**変更履歴:**
- v1.0.14 (2026-02-14): ワードウルフ投票システム修正
- v1.0.13 (2026-02-14): デマーシアシチュエーション表示修正
- v1.0.12 (2026-02-14): デマーシア投票システム実装
- v1.0.11 (2026-02-13): デマーシア表示バグ修正
