# ヴォイドに届くは光か闇か - 改善実装ドキュメント v3

## 🎯 実装した改善内容

このドキュメントは、2026年2月16日に実施された「ヴォイドに届くは光か闇か」ゲームの改善内容をまとめたものです。

---

## ✅ 実装済みの機能

### 1. 送信後の待機画面表示
**実装内容:**
- プレイヤーが回答を送信した後、自動的に待機画面に遷移
- `hasSubmitted`フラグで回答済み状態を管理
- 回答済みプレイヤーが再度入力画面にアクセスしようとすると待機画面を表示

**技術詳細:**
- `js/void-game.js`: 各送信関数で`hasSubmitted`フラグを設定
- `js/void-main.js`: `showVoidPlayScreen()`で回答済みチェック
- 回答済みの場合は`showVoidWaitingTurnScreen()`を呼び出し

### 2. 回答順番選択システム
**実装内容:**
- 待機画面から「ゲーム開始」ボタンで順番選択フェーズへ移行
- 1〜N番目の順番を選択（重複不可）
- リアルタイムで他のプレイヤーの選択状況を表示
- 全員が選択完了すると自動的にゲーム開始

**技術詳細:**
- `js/void-game.js`: `selectOrder()`と`finalizePlayOrder()`関数
- `index.html`: 順番選択画面UI
- Firebaseで`orderSelections`オブジェクトを管理

### 3. テーマのジャンル分けと表示
**実装内容:**
- LOL: `champions`（チャンピオン）、`items`（アイテム）、`places`（地域）、`concepts`（ゲーム用語）
- VALORANT: `agents`（エージェント）、`weapons`（武器）、`maps`（マップ）、`concepts`（ゲーム用語）
- すべての画面でジャンルを表示（順番選択、プレイ、待機）
- 多言語対応（日本語、英語、韓国語、中国語）

**技術詳細:**
- `js/void-data.js`: カテゴリー定義と`getThemeCategoryName()`関数
- `js/i18n.js`: カテゴリー名の多言語翻訳
- 全画面にジャンル表示UIを追加

### 4. 中間プレイヤーのワード修正システム
**実装内容:**
- **修正のみの実装**: 新規の言葉入力欄を削除
- 前のプレイヤーの3つの言葉から修正したいものだけを選択
- チェックボックスで修正対象を選び、修正後の言葉を入力
- 修正しなかった言葉はそのまま次のプレイヤーに伝わる

**技術詳細:**
- `js/void-main.js`: `showVoidMiddlePlayerScreen()`で修正オプションを動的生成
- `js/void-main.js`: `submitVoidMiddleWords()`で修正インデックスを記録
- `js/void-game.js`: `turnData.modified`配列で修正箇所を保存

### 5. 修正内容の視覚的表示
**実装内容:**
- 修正された言葉には「✏️ 修正済み」ラベルと黄色ハイライト表示
- 中間プレイヤー画面: 前のプレイヤーが修正した言葉を視覚的に表示
- 最後のプレイヤー画面: 修正済みの言葉を明示
- 結果画面: 各ターンで修正された言葉をハイライト表示

**技術詳細:**
- `js/void-main.js`: `wasModified`チェックで修正された言葉を判定
- `css/void-style.css`: `.void-history-modified`スタイル
- 多言語対応: `t('void.word.modified')`で翻訳

### 6. 現在のターン表示
**実装内容:**
- 待機画面で大きなターン番号表示（例: 3 / 4）
- 現在回答中のプレイヤー名を表示
- ローディングアニメーション付き

**技術詳細:**
- `index.html`: 待機画面のターン表示UI
- `js/void-main.js`: `showVoidWaitingTurnScreen()`で情報更新

---

## 📁 変更ファイル一覧

### 主要な変更
1. **js/void-game.js** (+80行)
   - 順番選択ロジック: `selectOrder()`, `finalizePlayOrder()`
   - `hasSubmitted`フラグ管理

2. **js/void-main.js** (+150行)
   - 修正済み言葉の視覚化
   - 待機画面の実装
   - 多言語対応の`t()`関数使用

3. **index.html** (+90行)
   - 順番選択画面UI
   - 待機画面UI
   - ジャンル表示UI

4. **js/i18n.js** (+12行)
   - 「修正済み」の多言語翻訳追加
   - 日本語: `'✏️ 修正済み'`
   - 英語: `'✏️ Modified'`
   - 韓国語: `'✏️ 수정됨'`
   - 中国語: `'✏️ 已修改'`

5. **css/void-style.css** (既存)
   - `.void-history-modified`スタイル定義済み

---

## 🎮 新しいゲームフロー

### 1. ルーム作成・参加
- プレイヤーがルームを作成
- 他のプレイヤーがルームIDで参加

### 2. 待機画面
- ホストが「ゲーム開始」ボタンをクリック

### 3. 順番選択フェーズ
- 各プレイヤーが1〜N番目の順番を選択
- テーマジャンルが表示される
- 重複不可、リアルタイム更新
- 全員選択完了で自動的にゲーム開始

### 4. プレイフェーズ
**最初のプレイヤー (1番目):**
- テーマを見る
- 3つの連想ワードを入力
- 送信後は待機画面へ

**中間プレイヤー (2〜N-1番目):**
- 前のプレイヤーの3つの言葉を見る
- 修正したい言葉だけをチェックして修正内容を入力
- 修正しない言葉はそのまま次へ
- 送信後は待機画面へ

**最後のプレイヤー (N番目):**
- 前のプレイヤーの3つの言葉を見る
- 元のテーマを推測して回答
- 送信後は結果画面へ

### 5. 待機画面（プレイ中）
- 現在のターン表示: 「3 / 4」
- 回答中のプレイヤー名表示
- テーマジャンル表示

### 6. 結果画面
- 正解/不正解の表示
- 元のテーマと最終回答の表示
- 各ターンのワード推移を表示
- 修正された言葉をハイライト表示

---

## 🌍 多言語対応

すべてのUI要素が4言語に対応：
- 🇯🇵 日本語
- 🇺🇸 英語
- 🇰🇷 韓国語
- 🇨🇳 中国語（簡体字）

---

## 🔍 動作確認方法

### 1. ブラウザのハードリロード
- Windows/Linux: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

### 2. 送信後の待機画面テスト
1. ルームを作成し、2人以上で参加
2. 順番を選択してゲーム開始
3. 自分のターンで回答を送信
4. **✅ 確認**: 送信後、自動的に待機画面に遷移
5. **✅ 確認**: 「〇〇が回答中...」と表示される

### 3. 順番選択システムテスト
1. ルームを作成し、複数人で参加
2. ホストが「ゲーム開始」をクリック
3. **✅ 確認**: 順番選択画面が表示される
4. 各プレイヤーが異なる順番を選択
5. **✅ 確認**: 重複選択はエラー表示
6. **✅ 確認**: 全員選択後、自動的にゲーム開始

### 4. ジャンル表示テスト
1. 順番選択画面でジャンル表示を確認
2. プレイ画面でジャンル表示を確認
3. 待機画面でジャンル表示を確認
4. **✅ 確認**: LOLなら「チャンピオン」「アイテム」等
5. **✅ 確認**: VALORANTなら「エージェント」「武器」等
6. 言語を切り替えてジャンル名が翻訳されることを確認

### 5. 修正システムテスト
1. 中間プレイヤーの番になる
2. 前のプレイヤーの3つの言葉が表示される
3. 修正したい言葉だけをチェック
4. 修正後の言葉を入力
5. **✅ 確認**: 送信後、次のプレイヤーに正しく伝わる
6. **✅ 確認**: 結果画面で修正された言葉が黄色でハイライト

### 6. 多言語テスト
1. 画面右上の言語切替ボタンをクリック
2. **✅ 確認**: 「✏️ 修正済み」が各言語で表示
3. **✅ 確認**: ジャンル名が各言語で表示

---

## 🎨 改善のポイント

### ユーザー体験の向上
1. **明確な進行状況**: 「3 / 4」のターン表示で全体の進行を把握しやすい
2. **視覚的フィードバック**: 修正された言葉が一目で分かる
3. **誤操作防止**: 回答済みプレイヤーは再入力不可
4. **公平な順番選択**: プレイヤー自身が順番を選べる

### ゲームバランスの改善
1. **難易度調整**: テーマジャンルの表示でヒントを提供
2. **戦略性向上**: 順番選択で戦略的なプレイが可能
3. **伝達の明確化**: 修正システムにより、意図が伝わりやすい

### 技術的改善
1. **データ構造の最適化**: `modified`配列で修正箇所を効率的に管理
2. **リアルタイム同期**: Firebaseで順番選択をリアルタイム更新
3. **多言語対応**: すべての新規UI要素が4言語対応

---

## 🚀 推奨される次のステップ

1. **ルール説明の更新**: 新しいゲームフローに合わせてルール説明を更新
2. **チュートリアル追加**: 初回プレイ時のガイド機能
3. **統計機能**: 正解率や平均修正回数などの統計表示
4. **リプレイ機能**: ゲーム終了後にワードの推移を再生

---

## 📝 まとめ

このアップデートにより、「ヴォイドに届くは光か闇か」は以下の点で大幅に改善されました：

✅ **送信後の待機画面**: 回答後の混乱を防止  
✅ **順番選択システム**: 公平で戦略的なゲーム進行  
✅ **ジャンル表示**: 難易度調整とヒント提供  
✅ **修正のみのシステム**: シンプルで直感的な操作  
✅ **視覚的フィードバック**: 修正された言葉を明確に表示  
✅ **多言語対応**: グローバルなプレイ体験

これらの改善により、ゲームはより楽しく、分かりやすく、戦略的になりました！

---

**実装日**: 2026年2月16日  
**バージョン**: v3.0  
**対応言語**: 日本語、英語、韓国語、中国語（簡体字）
